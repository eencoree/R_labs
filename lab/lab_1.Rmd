---
title: "Лабораторная работа №1"
author: "Реутов Александр"
date: "2022-10-31"
output: html_document
---

## Задание 1

### 1. Постановка задачи

Файл с данными lab1_e1.csv. Необходимо написать функцию fix_data, которая получает на вход набор данных, у которого в некоторых значениях числовых переменных добавлен пробел между цифрами. Требуется избавиться от этого пробела и вернуть числовым переменным их числовой тип.Функция должна возвращать преобразованный набор данных, при этом те переменные, которые действительно являются строковыми оставить без изменений

### 2. Работа с данными

Прочитаем с помощью функции read.csv таблицу, выведем ее и посмотрим тип каждого столбца:

```{r}
data <- read.csv("data/lab1_e1.csv", header = TRUE)
print(data)
```

Видим, что тип каждого столбца строковый

### 3. Реализация

Функция fix_data():

```{r}
fix_data <- function(some_data){
  for (i in names(some_data)){
    if(length(grep('[a-z]', some_data[[i]], ignore.case = T))==0)
      some_data[[i]] <- as.double(gsub(" ", "", some_data[[i]]))
  }
  return (some_data)
}
```

1)  В цикле проходим все столбцы
2)  Для каждого столбца проверяем содержит ли он буквы
3)  Если в пункте 2 нашли буквы, то переходим к следующему столбцу, иначе убираем все пробелы в строке и приводим ее к типу double
4)  Возвращаем преобразованную таблицу

### 4. Результаты

Выведем полученную после преобразования таблицу и заодно посмотрим на тип столбцов:

```{r}
data <- fix_data(data)
print(data)
```

Видим, что в столбцах с числовыми переменными действительно нет пробелов, а столбцы, которые были строковыми, остались без изменений

## Задание 2

### 1. Постановка задачи

Файл с данными lab1_e2.Rdata. Допустим, в рамках некоторого медицинского исследования тестировалась эффективность новой вакцины от вируса гриппа. Одной из целей исследования являлось изучить динамику температуры тела пациентов на протяжении недели после вакцинации. Пациенты должны были каждый день приходить на осмотр, где у них измеряли температуру. Каждый из семи дней экспериментатор вносил в таблицу id пациента и его температуру. После окончания исследования выяснилось, что некоторые пациенты не смогли посетить все семь приемов. Кто-то после первого раза больше не приходил на обследование, кто-то пропустил некоторые дни и т.д. Для чистоты исследования врачам необходимо отобрать из всех пациентов только тех, кто посетили каждый из семи приемов. Все данные хранятся в следующем формате: в списке all_data сохранены семь датафреймов, с двумя колонками:

1.  id - закодированное имя пациента
2.  temp - значения температуры.

Необходимо написать функцию get_id, которая получает на вход такого рода список, состоящий из семи датафрэймов. Функция, должна вернуть новый датафрэйм, в котором будут две переменные id и mean_temp - среднее значение температуры за неделю только тех пациентов, которые посетили все семь приемов.

### 2. Работа с данными

Загрузим данные и посмотрим, что в них содержится:

```{r}
load('data/lab1_e2.Rdata')
print(all_data)
```

Видим, что all_data содержит 7 датафреймов с неодинаковыми размерами

### 3. Реализация

```{r}
get_id <- function(df) {
  new_df <- do.call("rbind", df)
  mean_temp <- setNames(aggregate(temp ~ id, new_df, mean), c("id", "mean_temp"))
  id_count <- setNames(aggregate(temp ~ id, new_df, length), c("id", "count"))
  new_df <- merge(mean_temp, id_count, by = 'id')
  result <- subset(new_df, count == 7, select = c('id', 'mean_temp'))
  row.names(result) <- c(1:nrow(result))
  return (result)
}
```

1)  Получим 1 датафрейм из семи с помощью функции do.call с rbind
2)  Посчитаем сколько раз встретился каждый id
3)  Считаем среднюю температуру для каждого id
4)  Сольем 2 фрейма из (2) и (3) в один по id
5)  Выберем id для которых число совпадений больше или равно 7

### 4. Результаты

Применим нашу функцию get_id и посмотрим на то, что получилось:

```{r}
data_e2 <- get_id(all_data)
print(data_e2)
```

В итоге, получилось 14 человек, которые отмечались все 7 дней
